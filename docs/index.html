<!DOCTYPE html>
<html lang="sk-SK">
<head>
	<!-- Primary Meta Tags -->
	<title>WiFi termostat - ESP8266 / ESP32 - Webserver - riadenie kotla s hysterézou</title>
	<meta name="description" content="Izbový termostat navrhnutý na platforme Espressif - ESP8266 / ESP32. Termostat pre vykurovanie domácnosti s ovládaním plynového kotla.">
	<meta name="keywords" content="Termostat, digitálny, arduino ide, wemos d1 mini, nodemcu, wifi, esp8266, vykurovanie, kúrenie, webserver, socket, http, web, ip, ipv4, ds18b20, onewire, 1-wire">
	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://martinius96.github.io/WiFi-termostat/">
	<meta property="og:title" content="WiFi termostat - ESP8266 / ESP32 - Webserver">
	<meta property="og:description" content="Izbový termostat navrhnutý na platforme Espressif - ESP8266 / ESP32. Termostat pre vykurovanie domácnosti s ovládaním plynového kotla.">

	<!-- Twitter -->
	<meta property="twitter:card" content="summary_large_image">
	<meta property="twitter:url" content="https://martinius96.github.io/WiFi-termostat/">
	<meta property="twitter:title" content="WiFi termostat - ESP8266 / ESP32 - Webserver">
	<meta property="twitter:description" content="Izbový termostat navrhnutý na platforme Espressif - ESP8266 / ESP32. Termostat pre vykurovanie domácnosti s ovládaním plynového kotla.">
	
	<link rel="icon" type="image/png" href="favicon.png">
	<link rel="sitemap" type="application/xml" title="Sitemap" href="sitemap.xml" />
	<meta name="google-site-verification" content="UwZZh2EXv3iWUAi_1Z0hLxVCz6ySJ4UdY_BPoLtejwo" />    	
	<meta property='fb:admins' content='100001242570317'>
    	<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<script type="text/javascript">
    		window.smartlook||(function(d) {
    			var o=smartlook=function(){ o.api.push(arguments)},h=d.getElementsByTagName('head')[0];
    			var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript';
    			c.charset='utf-8';c.src='https://rec.smartlook.com/recorder.js';h.appendChild(c);
    		})(document);
    		smartlook('init', 'db50efe9fff280a17db52b82be221240cbbd3dbe');
	</script>    
		<style>
	#right {
  position: absolute;
  right: 0px;
}
	</style>
</head>
<body>
	<div class="container">
  		<div class="row">
    			<div class="col-sm-12">
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">WiFi termostat</a>
    </div>
    <ul class="nav navbar-nav">
      	<li class="active"><a href="index.html">Prehľad</a></li>
	<li><a href="zapojenie.html">Zapojenie</a></li>      
	<li class=""><a href="spustenie.html">Spustenie WiFi termostatu</a></li>
  <li><a href="json_client.html">JSON client</a></li>
      	<li><a href="kontakt.html">Kontakt</a></li>
<li style="float: right; "><a href="https://martinius96.github.io/termostat-ethernet/" class="btn btn-danger" role="button" title="Zmeniť projekt na Ethernet termostat"><img src="https://www.flaticon.com/svg/static/icons/svg/908/908547.svg" width=16px height=16px> <font color="white">Ethernet termostat</font></a></li>
    </ul>
  </div>
</nav>  
<div class="alert alert-success">
	<strong>Repozitár projektu so strojovými kódmi: </strong><a href="https://github.com/martinius96/WiFi-termostat/">WiFi termostat - posledný release kompilovaný z najnovšieho buildu Arduino Core 2.7.4.</a>
</div>	
<div class="alert alert-danger">
	<strong>Verzia 1.0.3 projektu WiFi termostat je posledným updatom verzie zdarma. Ďalšie chyby, bugy a bezpečnostné chyby nebudú riešené.</strong>
</div>	
<div class="alert alert-info">
	<strong>Článok k projektu na deadawp.blog.sector.sk: </strong><a href="http://deadawp.blog.sector.sk/blogclanok/13275/wifi-termostat-esp8266-1021-json-clients.htm">WiFi termostat - ESP8266 - 1.0.2.1 - JSON clients</a>
</div>	
<span class="label label-default">ESP8266</span>
<span class="label label-primary">ESP32</span>
<span class="label label-success">WiFi</span>
<span class="label label-info">DS18B20</span>
<span class="label label-warning">OneWire</span>
<span class="label label-danger">Dallas</span>
<span class="label label-default">HTML</span>
<span class="label label-primary">Webserver</span>
<span class="label label-success">WebSocket</span>
<span class="label label-info">JSON</span>
<span class="label label-warning">mDNS</span>	
<span class="label label-danger">UART</span>					
  <div class="row">
  <div class="col-sm-4"><center><img src="https://i.imgur.com/koSyFuW.png" width="128px" height="128px" style="border-radius: 50%;" alt="Riadiaci mikrokontróler NodeMCU v2 / v3 Lolin - ESP8266-12E / ESP8266-12F" title="Riadiaci mikrokontróler NodeMCU v2 / v3 Lolin - ESP8266-12E / ESP8266-12F"><br><b>NodeMCU v3 Lolin</b></center></div>
  <div class="col-sm-4"><center><img src="https://i.imgur.com/FV9xi6K.png" width="128px" height="128px" style="border-radius: 50%;" alt="Riadiaci mikrokontróler Wemos D1 Mini - ESP8266-12E / ESP8266-12F" title="Riadiaci mikrokontróler Wemos D1 Mini - ESP8266-12E / ESP8266-12F"><br><b>Wemos D1 Mini</b></center></div>
  <div class="col-sm-4"><center><img src="https://i.imgur.com/BczG03b.png" width="128px" height="128px" style="border-radius: 50%;" alt="Riadiaci mikrokontróler ESP32 Devkit V1 - ESP-WROOM-32 / ESP32-S" title="Riadiaci mikrokontróler ESP32 Devkit V1 - ESP-WROOM-32 / ESP32-S"><br><b>ESP32 DevKit</b></center></div>
</div>					
<hr><center><h2>WiFi termostat - ESP8266 / ESP32</h2></center><hr>
<p style="text-align: justify;">
Programová implementácia je navrhnutá pre mikrokontrólerové platformy od výrobcu Espressif Systems s WiFi konektivitou. 
Konkrétne mikrokontróler ESP8266 vo verzii 12E až F využívaný v platformách Wemos D1 Mini, NodeMCU v2, v3.
<b>Mikrokontroléry ESP8266-01 / ESP8266-01S a podobné standalone čipy pred generáciou 12E nie sú kompatibilné pre projekt z hľadiska nahrávania programu, nakoľko nevyužívajú flash metódu DIO, pre ktorú sú navrhnuté volania nástroja ESPTOOL v projekte, úpravou flash metódy je možné zabezpečiť nahratie firmvéru aj do týchto zariadení.</b>
Pre mikrokontrolér z rady ESP32 je možné využívať standalone čipy ESP32-WROOM-32 od Espressifu i ekvivalent ESP-32S od AI-Thinker. 
Kompatibilné sú aj všetky DevKity obsiahnuté s týmito čipmi, sú plné kompatibilné (napríklad DevKit v1 / DevKiTC-v4).
WiFi termostat je prístupný z LAN siete v ktorej sa nachádza, pričom je vybavený webovým rozhraním ktoré slúži na konfiguráciu všetkých prvkov termostatu.
Termostat riadi kotol na základe nameranej, cieľovej teploty a hysterézy nezávisle na webaplikácii, ktorá slúži na konfiguráciu a rozhodovací prah termostatu.
Okrem dostupnosti termostatu na konkrétnej IP adrese je možné termostat doplniť o mDNS záznam, ktorý generuje lokálnu doménu (hostname.local) prístupnú iba v LAN sieti v rámci tejto multicastovej služby. 
Konfigurácia termostatu (z pohľadu konektivity) na domácu WiFi LAN sieť je zabezpečená prostredníctvom WiFiManagera, ktorý údaje o WiFi sieti (SSID a heslo) ukladá do flash pamäte mikrokontroléru.
Uloženie je jednorázové a zariadenie si konfiguráciu pamätá permanentne. Po nadobudnutí konektivity (priradení IP adresy od routra vašej domácej WiFi siete) je možné termostat plne používať.
HTTP webserver bežiaci na mikrokontorléri ESP8266 / ESP32 umožňuje beh niekoľkých na sebe nezávislých HTML stránok, ktoré môžu mať informatívny, alebo aj funkcionálny charakter.
</p>
<b>Po hardvérovej stránke projekt využíva:</b>
<li>ESP8266 / ESP32</li>
<li>Teplotný senzor DS18B20 na OneWire zbernici</li>
<li>Relé SRD-5VDC-SL-C / OMRON G3MB-202P slúžiace na spínanie kotla (Active-LOW signál)</li>
<b>HTML stránky bežiace na platforme ESP8266 / ESP32:</b>
<li><b>/</b> - root stránka obsahujúca formulár, aktuálny výpis logického výstupu pre relé, aktuálnu a cieľovú teplotu teplotu, hysterézu</li>
<li><b>/action.html</b> - spracúvava hodnoty z formulára, zapisuje ich do emulovanej EEPROM pamäte, presmeruje používateľa späť na root stránku</li>
<li><b>/get_data.json</b> - distribuuje dáta o aktuálnej teplote, referenčnej teplote a hysteréza tretej strane (počítač, mikrokontróler, iný klient...) v JSON formáte - možno využiť s príkladom JSON klient, ktorý dáta vie odoslať na MQTT Broker, napríklad do domácej automatizácie</li>
<li>a iné systémové podstránky pre ovládanie výstupu, zmenu režimu</li>
<hr>	
<p style="text-align: justify;">		
<b>Rozlíšenie senzora DS18B20 pri meraní je 12-bitov, čomu rozpovedá rozlíšenie na 0.0625 °C. Dáta po OneWire zbernici môžu vrátiť do mikrokontroléru po vyžiadaní za 500 až 1000 ms.</b>	
Elektromagnetické relé SRD-5VDC-SL-C, ktoré je v projekte použité umožňuje spínať až 10A pri 230V - výkon 2300W. 
V prípade spínania jednosmerného obvodu (záťaže) je možné spínať 300W (10A pri 30V DC). 
Prípadne je pre schému zapojenia plne kompatibilné aj SSR relé OMRON G3MB-202P, ktoré je vhodné iba pre neindukčnú záťaž a výhradne pre obvod so striedavým napätím. 
Maximálny spínaný výkon 460W (230V, 2A). <b>Termostat je možné používať celoročne. V prípade nepotrebného riadenia je možné výstup fyzicky odpojiť a termostat využívať ako WiFi teplomer pre zisk dát z miestnosti, kde sa nachádza.</b> 
Logika termostatu sa vykonáva každých 10 sekúnd nezávisle na webserveri a pripojených klientoch, nevyžaduje sa keep-alive spojenie pre jej vykonanie. 
Vždy pri vykonaní logiky vypíše na UART termostat aj informáciu o aktuálnej IP adrese, respektíve aj mDNS zázname (ak sa s mDNS firmvér používa) a dá tak používateľovi informáciu, kde v LAN sieti je termostat dosiahnuteľný so svojim webovým rozhraním.
Okrem toho vypíše aj dynamickú voľnú pamäť - HEAP, ktorá sa pohybuje na úrovni 40 až 44kB a taktiež aj aktuálny stav výstupu s oznámením zmeny ak k nej dôjde --> (ak pretečie rozhodovací threshold do + respektíve do -).
<b>3V3 operačná logika GPIO mikrokontrolérov ESP8266 a ESP32 postačuje pre digitálny signál zmeny, relé však musí byť napájané na 5V z VUSB, respektíve VIN.</b>
</p>

<b>Webové rozhranie pre WiFi termostat umožňuje:</b>
<li>Prehliadať v reálnom čase teplotu zo senzora DS18B20, uptime zariadenia, hodnotu výstupu s dynamickou zmenou, aktuálne nastavené konfiguračné údaje pre termostat t.j. cieľovú teplotu a hysterézu</li>
<li>Modifikovať cieľovú (referenčnú) teplotu <del>v rozsahu 5 až 50 °C s 0,25 °C krokom</del></li>
<li>Modifikovať hysterézu <del>v rozsahu 0 až 10 °C s 0,25 °C krokom</del></li>
<div class="alert alert-danger">
  <strong>Programová implementácia termostatu s automatickým režimom je experimentálna!</strong>
</div>
<b>ZAP/VYP regulácia kotla - automatický režim:</b> 
<li>Príklad ZAP/VYP regulácie vykurovania - <font color="red">VIZUALIZÁCIA NIE JE SÚČASŤOU PROJEKTU</font></li>	
<li>Kotol je aktívny po dobu dostiahnutia cieľovej teploty + hysterézy</li>
<li>Na vizualizácii teplôt vody je patrný tzv. dobeh vykurovania a následné chladnutie vody až do opätovnej aktivity vykurovania, kedy je nameraná teplota pod nastavenú cieľovú teplotu - hystérzu</li>		
<img src="https://i.imgur.com/IDWLuOr.png" style="display: block; max-width: 100%; height: auto;" alt="ZAP/VYP regulácia kotla s hysterézou" title="ZAP/VYP regulácia kotla s hysterézou">   
<p style="text-align: justify;">
<b>Do základnej verzie WiFi termostatu (bez mDNS záznamu) bol implementovaný manuálny režim ovládania (natvrdo ZAP/VYP) s možnosťou prepínania medzi manuálnym a automatickým režimom.</b>
Webové rozhranie je navrhnuté pre prispôsobenie sa väčším i menším obrazovkám. Je responzívne, podporuje širokouhlé obrazovky s vysokým rozlíšením, ale aj mobilné zariadenia. 
Rozhranie využíva importované CSS štýly Bootstrap frameworku z externého CDN servera, ktorý načíta client-side zariadenie pri otvorení stránky bežiacej na ESP. 
Importovaním CSS štýlov z externého servera umožní znížiť výkonové a pamäťové zaťaženie mikrokontroléru.  
</p>
<center><img src="https://i.imgur.com/8shZ0K3.png" style="display: block; max-width: 100%; height: auto;" alt="WiFi termostat - webové rozhranie vizualizované v systéme Android - Chrome" title="WiFi termostat - webové rozhranie vizualizované v systéme Android - Chrome"></center>   		
<hr>
<p style="text-align: justify;">
Aby ostali nastavené hodnoty termostatu zachované aj po výpadku napájania, sú uložené do EEPROM pamäte ESP, ktorá je emulovaná vo flash pamäti, nakoľko platforma nemá fyzicky EEPROM čip (pamäť). 
Referenčná teplota na offset 10, hysteréza na offset 100. Každá z hodnôt zaberá maximálne 5B v EEPROM pamäti + ukončovací znak. 
Dáta sa prepisujú iba pri odoslaní HTML formulára, prevádzka termostatu je tak maximálne šetrná k EEPROM pamäti pre jej maximálnu trvácnosť. 
Stav výstupu existuje iba v RAM pamäti, neukladá sa do flash pamäte.
V prípade, že zariadenie pri prvom spustení nemá nič uložené na spomenutých EEPROM offsetoch, vykoná sa automatický zápis s predvolenými hodnotami - referencia: 20.25 °C, hysteréza 0.00 °C, tzv. fail-safe riešenie.
ESP8266 a ESP32 pre prácu s EEPROM pamäťou využíva funkcie EEPROM.put() v spojitosti s EEPROM.commit() a pre čítanie dát z EEPROM EEPROM.get(), ktoré podporujú akýkoľvek dátový typ, v našom prípade float().
</p>
<p style="text-align: justify;">
Prostredníctvom meta tagu Refresh vykonáva webserver obnovu celej stránky každých 30 sekúnd a prostredníctvom Javascriptu sa vypisuje do HTML stránky aj orientačný čas do refreshu. 
Do tohto času je potrebné stihnúť zapísať zmenu pre termostat, inak sa input okná pre číselné vstupy do formulára resetujú pri obnovení stránky. 
Nakoľko built-in knižnica Ethernet neobsahuje využitie asynchrónneho webservera (ktorý je možné využiť napríklad u mikrokontrolérov Espressif ESP8266 / ESP32), je nutné prepisovať celú stránku. 
Dynamický údaj, ktorý sa predovšetkým mení je aktuálna hodnota výstupu - <b><font color="#27AE60">Zapnutý</font></b> / <b><font color="red">Vypnutý</font></b>, ktorý informuje prevádzkovateľa o skutočnom stave výstupu spoločne aj s farebným označením. 
Nakoľko sa logika systému  vykonáva nezávisle na webserveri, do refreshu môže už byť výstup v inom stave, ako aktuálne vypísanom vo webaplikácii. Zmena výstupu je ihneď vypísaná napríklad na UART monitor.
Na webovej stránke termostatu nájde používateľ aj informácie o uptime zariadenia (ako dlho beží), t.j. čas v dňoch, hodinách, minútach a sekundách. <b>Termostat je určený iba pre interiérové teploty!</b> (nad 0°C), čomu je prispôsobená aj logika systému! 
Termostatom je možné nahradiť už existujúci izbový termostat, možno dočasne nahradiť ohrievač v akváriu / teráriu pre udržiavanie stálej teploty.
</p>
<div class="alert alert-danger">
	<strong>Autor WiFi termostatu nezodpovedá za funkčnosť termostatu, poruchu kotla, úraz elektrickým prúdom pri neodbornej montáži termostatu do siete.</strong> Termostat je šírený pod MIT licenciou.
</div>	
<b>Hlavná stránka pre modifikáciu cieľovej teploty a hysterézy - ukážka zapnutého:</b>
<div class="alert alert-info">
	<strong>Ukážkové dáta</strong>
	<li><b>Cieľová teplota:</b>  22.75 °C</li>
	<li><b>Hysteréza:</b>  0.25 °C</li>
	<li><b>Namerané dáta:</b>  21.59 °C</li>
	<li><b>Výstup:</b>  <font color="#27AE60">Zapnutý</font></li>
	<hr>
	<p style="text-align: justify;">
		Termostat vykuruje od nameranej teploty 22.49 °C a nižšej. 
		V prípade dosiahnutia teploty 23.01 °C sa výstup vypne, signalizačné relé sa rozpojí a plynový kotol prestáva kúriť. 
		Nastáva dobeh vykurovania a chladnutie miestnosti v ktorej sa vykonávajú merania. Termostat sa opäť aktivuje až pri dosiahnutí teploty 22.49 °C, alebo nižšej.	
	</p>	
</div>

<b>Hlavná stránka pre modifikáciu cieľovej teploty a hysterézy:</b>
<img src="https://i.imgur.com/YX7W2Z8.png" style="display: block; max-width: 100%; height: auto;" alt="WiFi termostat - Hlavný prehľad s modifikáciou cieľovej teploty a hysterézy - Vypnutý" title="WiFi termostat - Hlavný prehľad s modifikáciou cieľovej teploty a hysterézy - Vypnutý">        			

<b>Priebeh spracovania zadaných údajov (presmerovanie používateľa):</b>
<img src="https://i.imgur.com/ZptC0UR.png" style="display: block; max-width: 100%; height: auto;" alt="WiFi termostat - spracovanie údajov z HTML formulára" title="WiFi termostat - spracovanie údajov z HTML formulára">        			

<b>JSON výstup webservera v prehliadači / klientovi cez websocket:</b>
<center><img src="https://i.imgur.com/iqxV12k.png" style="display: block; max-width: 100%; height: auto;" alt="WiFi termostat - JSON output" title="WiFi termostat - JSON output"></center>        		

<b>Výstup do UART monitoru - logika systému + nastavená IP adresa, mDNS záznam:</b>
<center><img src="https://i.imgur.com/f1mF6Fk.png" style="display: block; max-width: 100%; height: auto;" alt="WiFi termostat - UART" title="WiFi termostat - UART"></center>        		

<b>Rozšírená verzia tohto termostatu obsahuje navyše - <font color="red">NIE JE OBSIAHNUTÁ V GITHUB REPOZITÁRI SO SKOMPILOVANÝM FIRMVÉROM:</font></b>
<div class="alert alert-info">
	<b>Pri záujme o kúpu plnej verzie projektu so zdrojovým kódom (.ino) - </b>martinius96@gmail.com
</div>
<li>Zdrojový kód (.ino)</li>
<li>Watchdog timer</li>
<li>Dostupné senzory SHT21, SHT31, DHT22, BME280, BMP280 a iné</li>
<li>Režim chladenia</li>
<li>Basic OTA, OTA Web Updater, Elegant remote OTA</li>
<li>Možnosť ovládania cez UDP datagramy - callbacky, prostredníctvom UDP clientov (Packet Sender).</li>
<li>Interakcia s Amazon Alexa Echo Dot s možnosťou hlasového ovládania termostatu</li>
<li>Možnosť Publishu dát na MQTT Broker / cez HTTP / HTTPS request na vzdialený webserver s uložením dát do MySQL databázy (bez JSON clienta)</li>
<hr>
<h3><font color="#C0392B">Ukážkový výpis - JSON output pre ďalších klientov, spracovanie</font></h3>
<div class="alert alert-danger">
{<br>
	"Hysteresis":0.25,<br>
	"Target_Temperature":21.75,<br>
	"Actual_Temperature":21.43<br>
}
</div>

<h3><font color="#2ECC71">WiFi termostat - zdrojový kód - ESP32 - experimental</font></h3>
<pre style="background-color:#2ECC71;">
/*|----------------------------------------------------------|*/
/*|HTTP webserver - FORM - HTML - PROCESSING - EEPROM        |*/
/*|AUTHOR: Martin Chlebovec                                  |*/
/*|----------------------------------------------------------|*/
#include <WiFi.h>
#include <WebServer.h>
#include <EEPROM.h>
WebServer server(80);
#include <OneWire.h>
#include <DallasTemperature.h>

#define ONE_WIRE_BUS 23 //D23
OneWire oneWire(ONE_WIRE_BUS);
DallasTemperature sensorsA(&oneWire);
const int rele = 22; //D22
unsigned long cas = 0;
float teplota;
String stav;

const char * ssid = "NAZOV_WIFI_SIETE"; //meno wifi siete
const char * password = "HESLO_WIFI_SIETE"; //heslo na wifi siet

void writeString(char add, String data)
{
  int _size = data.length();
  int i;
  for (i = 0; i < _size; i++)
  {
    EEPROM.write(add + i, data[i]);
    EEPROM.commit();
  }
  EEPROM.write(add + _size, '\0'); //Add termination null character for String Data
  EEPROM.commit();
}


String read_String(char add)
{
  int i;
  char data[100]; //Max 100 Bytes
  int len = 0;
  unsigned char k;
  k = EEPROM.read(add);
  while (k != '\0' && len < 500) //Read until null character
  {
    k = EEPROM.read(add + len);
    data[len] = k;
    len++;
  }
  data[len] = '\0';
  return String(data);
}


void handleRoot() {
  String stranka = "<!DOCTYPE html>";
  stranka += "<html>";
  stranka += "<head>";
  stranka += "<meta charset='utf-8'>";
  stranka += "<meta name='author' content='Martin Chlebovec'>";
  stranka += "<meta http-equiv='Refresh' content='10'; />";
  stranka += "<meta name='viewport' content='width=device-width, initial-scale=1'>";
  stranka += "<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css'>";
  stranka += "<script type='text/javascript'>";
  stranka += "var timeleft = 10;";
  stranka += "var downloadTimer = setInterval(function(){";
  stranka += "if(timeleft <= 0){";
  stranka += "clearInterval(downloadTimer);";
  stranka += "document.getElementById(\"countdown\").innerHTML = \"Reštart...\";";
  stranka += "} else {";
  stranka += "document.getElementById(\"countdown\").innerHTML = timeleft + \" sekúnd do reštartu\";";
  stranka += "}";
  stranka += "timeleft -= 1;";
  stranka += "}, 1000);";
  stranka += "</script>";
  stranka += "<title>HTTP webserver - ESP8266</title>";
  stranka += "</head>";
  stranka += "<body>";
  stranka += "<center><h3>Zadajte dáta pre webserver:</h3>";
  stranka += "<form action='/action.html' method='get'>";
  stranka += "<b>Referenčná teplota:</b><br><input type='number' id='fname' name='fname' min='5' max='50' step='0.25' value=" + read_String(100) + "><br>";
  stranka += "<b>Hysteréza:</b><br><input type='number' id='fname2' name='fname2' min='0' max='10' step='0.25' value=" + read_String(10) + "><br>";
  stranka += "<input type='submit' class='btn btn-success' value='Zapísať'>";
  stranka += "</form><hr>";
  if (stav == "ZAP") {
    stranka += "<b><font color='green'>Výstup: Zapnutý</font></b>";
  }
  if (stav == "VYP") {
    stranka += "<b><font color='red'>Výstup: Vypnutý</font></b>";
  }
  stranka += "<div id=\"countdown\"></div>";
  stranka += "<b>Aktuálna teplota senzora DS18B20:</b> ";
  stranka += String(teplota);
  stranka += " °C";
  stranka += "</center>";
  stranka += "</body>";
  stranka += "</html>";
  server.send(200, "text/html", stranka);
}

void handleBody() {
  if (server.hasArg("fname")) {
    float cielova_teplota = server.arg("fname").toFloat();
    Serial.println("Dostali sme tieto data --> ref. teplota:");
    Serial.println(cielova_teplota);
    writeString(100, String(cielova_teplota));
  }
  if (server.hasArg("fname2")) {
    float hystereza = server.arg("fname2").toFloat();
    Serial.println("Dostali sme tieto data --> hystereza:");
    Serial.println(hystereza);
    writeString(10, String(hystereza));
  }
  String stranka = "<!DOCTYPE html>";
  stranka += "<html>";
  stranka += "<head>";
  stranka += "<meta charset='utf-8'>";
  stranka += "<meta http-equiv='Refresh' content='5; url=/' />";
  stranka += "<title>HTTP webserver - Arduino + Ethernet</title>";
  stranka += "</head>";
  stranka += "<body>";
  stranka += "<center><h3>Server prijal data z formulára:</h3>";
  stranka += "<li><b>Referenčná teplota: </b>" + String(server.arg("fname")) + "</li>";
  stranka += "<li><b>Hysteréza: </b>" + String(server.arg("fname2")) + "</li>";
  stranka += "<b>Presmerovanie... Prosim cakajte</b></center>";
  stranka += "</body>";
  stranka += "</html>";
  server.send(200, "text/html", stranka);
}

void handleGet() {
  String stranka = "{\n";
  stranka += "\"Hysteresis\":";
  stranka += read_String(10);
  stranka += ",\n";
  stranka += "\"Target_Temperature\":";
  stranka += read_String(100);
  stranka += ",\n";
  stranka += "\"Actual_Temperature\":";
  stranka += String(teplota) + "\n";
  stranka += "}\n";
  server.send(200, "application/json", stranka);
}

void setup() {
  Serial.begin(115200);
  EEPROM.begin(512);
  String a = read_String(10);
  String b = read_String(100);
  if (a == "" || a == NULL) {
    writeString(10, "0.25");
  }
  if (b == "" || b == NULL) {
    writeString(100, "20.25");
  }
  sensorsA.begin();
  pinMode(rele, OUTPUT);
  digitalWrite(rele, HIGH);
  sensorsA.requestTemperatures();
  delay(750);
  WiFi.begin(ssid, password); //pripoj sa na wifi siet s heslom
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.print(".");
  }
  Serial.println("Ready");
  Serial.println("");
  Serial.println("WiFi connected.");
  Serial.println("IP address: ");
  Serial.println(WiFi.localIP());
  server.on("/", handleRoot);
  server.on("/get_data.json", handleGet);
  server.on("/action.html", HTTP_GET, handleBody);
  server.begin();
}

void loop() {
  if ((millis() - cas) >= 10000 || cas == 0) {
    cas = millis();
    teplota = sensorsA.getTempCByIndex(0);
    String referencia = read_String(100);
    String hystereza = read_String(10);
    float referencia_teplota = referencia.toFloat();
    float hystereza_teplota = hystereza.toFloat();
    float minus_hystereza_teplota = (-1 * hystereza_teplota);
    float rozdiel = referencia_teplota - teplota;
    if (rozdiel > hystereza_teplota) {
      Serial.println("RELE ZAP");
      stav = "ZAP";
      digitalWrite(rele, LOW);
    } else if (rozdiel < minus_hystereza_teplota) {
      Serial.println("RELE VYP");
      stav = "VYP";
      digitalWrite(rele, HIGH);
    }
    sensorsA.requestTemperatures();
  }
  server.handleClient();
  yield();
}

</pre>
 </div>
</div>
</div>
</body>
</html>
